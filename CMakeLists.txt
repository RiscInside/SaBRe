cmake_minimum_required (VERSION 2.8)
project (SaBRe C ASM)

find_program(GCC_PATH gcc)

option(DEBUG "Print debug messages" OFF)
if (DEBUG)
  add_definitions(-DSBR_DEBUG)
endif(DEBUG)

option(RDTSC "Intercept instruction RDTSC as a system call" ON)
if (RDTSC)
  if (${CMAKE_SYSTEM_PROCESSOR} STREQUAL "x86_64")
    add_definitions(-D__NX_INTERCEPT_RDTSC)
  else ()
    message(WARNING "Intercepting RDTSC does not make sense on non x86_64 architectures")
  endif()
endif(RDTSC)

# Sources
add_subdirectory("libsrc")
add_subdirectory("loader")
file(GLOB subdirs CONFIGURE_DEPENDS "plugins/*")
foreach(subdir ${subdirs})
  add_subdirectory(${subdir})
endforeach()
file(GLOB subdirs CONFIGURE_DEPENDS "arch/*")
foreach(subdir ${subdirs})
  add_subdirectory(${subdir})
endforeach()
